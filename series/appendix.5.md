# Appendix 5: 情報幾何学における双対構造：2種類のまっすぐ

情報幾何学の最も深い洞察の一つは、確率分布の空間には **2種類の「まっすぐ」** が存在するということである。これは通常のユークリッド空間では区別されないが、確率空間の本質的な非対称性を反映している。

## e-接続とm-接続

**接続（connection）** とは、多様体上でベクトルを「平行移動」する方法を定める構造である。通常のユークリッド空間では一意だが、曲がった空間では複数の「まっすぐ」の定義がありうる。

情報幾何学では、Fisher計量と整合的な2つの接続が特に重要である：

| 接続 | 名称 | 測地線の特徴 | 自然なパラメータ空間 |
| --- | --- | --- | --- |
| **e-接続** | 指数接続<br>(exponential connection) | 指数型分布族で直線 | 自然パラメータ $\boldsymbol{\theta}$ |
| **m-接続** | 混合接続<br>(mixture connection) | 凸結合（混合分布）で直線 | 期待値パラメータ $\boldsymbol{\eta}$ |

これらは **双対アファイン接続（dual affine connections）** と呼ばれ、Fisher計量に関して互いに双対である。

**e-接続における測地線**：
指数型分布族 $p(x; \boldsymbol{\theta}) = \exp(\boldsymbol{\theta}^\top \mathbf{t}(x) - \psi(\boldsymbol{\theta}))$ において、自然パラメータ $\boldsymbol{\theta}$ を線形補間すると、それは e-接続の測地線となる：

$$p_t(x) = \exp\Big(\boldsymbol{\theta}(t)^\top \mathbf{t}(x) - \psi(\boldsymbol{\theta}(t))\Big), \quad \boldsymbol{\theta}(t) = (1-t)\boldsymbol{\theta}_0 + t\boldsymbol{\theta}_1$$

Softmaxで言えば、**商空間 $\mathbb{R}^K / \mathbb{R}\mathbf{1}$ 上での直線（あるいはゲージ固定したロジット座標での直線）が、e-接続の測地線に対応する**。前述の通り、Softmaxは $\mathbf{1}$ 方向の平行移動に不変であるため、e-測地線も実質的にこの商空間上で定義される。

**m-接続における測地線**：
一方、確率分布の凸結合（混合分布）：

$$p_t(x) = (1-t)p_0(x) + t p_1(x)$$

これは m-接続の測地線となる。**カテゴリカル分布の場合**、期待値パラメータ $\boldsymbol{\eta}$ は確率 $\mathbf{p}$ そのものに対応するため、確率単体 $\Delta^{K-1}$ をユークリッド空間の部分集合と見たときの通常の直線が、この測地線に対応する。

> [!NOTE]
> **「2種類のまっすぐ」の直感：**
>
> - **e-接続（指数）**：「掛け算の世界」での直線。確率の対数（ロジット）を線形補間すると、指数をとって戻したとき e-測地線になる。
> - **m-接続（混合）**：「足し算の世界」での直線。確率そのものを線形補間すると m-測地線になる。
>
> これら2つは、空間の「曲がり方」の異なる2つの見方を提供する。どちらが「正しい」のではなく、両方が情報幾何学の対称的な構造を構成する。

## α-接続：2つの「まっすぐ」を繋ぐ連続パラメータ

前節で導入したe-接続とm-接続は、実は **連続的なパラメータ $\alpha$ を持つ接続族の両端** に位置する特殊な場合である。ここでは、そのパラメータ $\alpha$ の全体像を見ることで、e/m接続の位置づけをより明確にする。

### α-接続の定義

統計多様体 $\mathcal{S}$ 上の **$\alpha$-接続** $\nabla^{(\alpha)}$ は、実数パラメータ $\alpha \in \mathbb{R}$ によって連続的にパラメトライズされる接続の族である。Fisher計量 $g$ と **Amariの $\alpha$-接続** の関係は、以下の式で定められる：

$$\nabla^{(\alpha)} = \nabla^{(0)} + \frac{\alpha}{2} T$$

ここで $\nabla^{(0)}$ はFisher計量に関するLevi-Civita接続、$T$ は統計多様体の3次テンソル（**スキューネス・テンソル**、あるいは立方形式とも呼ばれる）である。

このテンソル $T$ は、確率分布の対数尤度の3次微分から構成される量であり、統計多様体がユークリッド空間とは異なる「歪み」を持つことを反映している。$T = 0$ であれば全ての $\alpha$-接続は一致するが、一般の統計多様体では $T \neq 0$ であるため、$\alpha$ の値に応じて異なる「まっすぐ」が生じる。

$\alpha$-接続族のうち、特別な3つの値が重要な役割を果たす：

| $\alpha$ | 接続 | 性質 |
| --- | --- | --- |
| $+1$ | **e-接続** $\nabla^{(1)}$ | 指数型分布族で平坦 |
| $0$ | **Levi-Civita接続** $\nabla^{(0)}$ | 計量と捩率の両立（後述） |
| $-1$ | **m-接続** $\nabla^{(-1)}$ | 混合分布族で平坦 |

そして、 $\alpha$-接続と $(-\alpha)$-接続は、Fisher計量 $g$ に関して常に **双対関係** にある。つまり、任意のベクトル場 $X, Y, Z$ に対して：

$$X \cdot g(Y, Z) = g(\nabla^{(\alpha)}_X Y, Z) + g(Y, \nabla^{(-\alpha)}_X Z)$$

この双対性こそが、e-接続（$\alpha=+1$）とm-接続（$\alpha=-1$）が対をなす理由であり、 $\alpha=0$ のLevi-Civita接続が **自己双対（自分自身と双対）** であることも意味している。

> [!NOTE]
> **α-接続の直感：「まっすぐ」のスペクトル**
>
> $\alpha$-接続は、「掛け算の世界」（$\alpha=+1$）と「足し算の世界」（$\alpha=-1$）の間を連続的に補間する「まっすぐ」のスペクトルである。
>
> - $\alpha = +1$：ロジット空間での直線（掛け算＝指数の世界）
> - $\alpha = 0$：通常のリーマン幾何学的な測地線（長さを最短にする曲線）
> - $\alpha = -1$：確率空間での直線（足し算＝混合の世界）
>
> パラメータ $\alpha$ を $+1$ から $-1$ へ連続的に動かすと、「まっすぐ」の定義がロジット空間での直線から確率空間での直線へと滑らかに変形していく。

### Levi-Civita接続（α=0）の位置づけ

$\alpha = 0$ に位置するLevi-Civita接続は、リーマン幾何学において最も標準的な接続であり、一般相対論やリーマン幾何学の教科書で単に「接続」と言えばこれを指す。Levi-Civita接続は、以下の2つの条件で一意に定まる：

1. **計量整合性（metric compatibility）**：平行移動でベクトルの内積（長さ・角度）が保たれる。
2. **捩率なし（torsion-free）**：平行移動の「ねじれ」が存在しない。

この2条件を同時に満たす接続は、与えられた計量に対して唯一つしか存在しない（リーマン幾何学の基本定理）。つまり、Levi-Civita接続は **「長さを変えない、最も素直なまっすぐ」** を定める接続であり、その測地線は2点間の **最短距離（ないし最短停留曲線）** を与える。

> [!NOTE]
> **Levi-Civitaの馴染み深さ：**
>
> 地球の大円航路（2都市間の最短飛行経路）は、球面上のLevi-Civita接続の測地線である。一般相対論で光や質点が曲がった時空を進む経路（測地線方程式）も、時空計量に関するLevi-Civita接続によって決まる。物理学で「直線的に進む」と言うとき、ほぼ常にこの接続が暗黙に使われている。

ただし、α-接続のうち $\alpha \neq 0$ の接続は、一般に **計量整合的でない** 。e-接続やm-接続に沿ってベクトルを平行移動すると、内積（長さ）が変化しうる。この「欠点」と引き換えに得られるのが、次項で述べる **平坦性** という極めて強力な構造である。

### なぜ情報幾何では α=±1 なのか

リーマン幾何学の立場から見れば、Levi-Civita接続（$\alpha=0$）こそが最も自然で「正統な」選択に思える。では、なぜ情報幾何学はわざわざ $\alpha = \pm 1$ を好むのか。

その理由は、**統計多様体上では Levi-Civita接続は一般に平坦にならない** からである。

指数型分布族の空間にFisher計量を入れてLevi-Civita接続を計算すると、一般に曲率はゼロにならない（空間は曲がっている）。つまり、Levi-Civita接続の世界では、確率分布の空間に大域的な「まっすぐな座標系」を入れることができない。

一方、e-接続（$\alpha = +1$）では：自然パラメータ $\boldsymbol{\theta}$ を使うと **曲率がゼロ**（e-平坦）。
m-接続（$\alpha = -1$）では：期待値パラメータ $\boldsymbol{\eta}$ を使うと **曲率がゼロ**（m-平坦）。

この対比を表にまとめる：

| 接続 | 長さの保存 | 平坦性 | 大域的な直線座標 |
| --- | --- | --- | --- |
| Levi-Civita（$\alpha=0$） | 保存する | 一般に曲がる | 存在しない |
| e-接続（$\alpha=+1$） | 保存しない | **平坦** | $\boldsymbol{\theta}$（自然パラメータ） |
| m-接続（$\alpha=-1$） | 保存しない | **平坦** | $\boldsymbol{\eta}$（期待値パラメータ） |

情報幾何学における根本的なトレードオフがここにある。**長さを保つ接続は空間を平坦にできず、空間を平坦にする接続は長さを保てない。** 統計的推論や機械学習の文脈では、「空間が平坦であること」は決定的に重要である。平坦であれば線形代数が使え、射影や最適化が明快になるからである。

> [!IMPORTANT]
> **Softmaxの構造を見るために：**
>
> Softmaxが「自然な」変換であること——すなわち、自然パラメータ $\boldsymbol{\theta}$（ロジット）と期待値パラメータ $\boldsymbol{\eta}$（確率）を結ぶ勾配写像であること——を理解するには、**Levi-Civita接続ではなく $\alpha = \pm 1$ の世界** を見る必要がある。Levi-Civita接続のもとでは、この双対パラメータの整然とした関係（双対平坦性）が見えてこない。
>
> 「長さを変えない素直なまっすぐ」を手放すことで、確率空間の最も美しい構造——2つの平坦座標系とそれを結ぶSoftmax——が姿を現すのである。

## 双対平坦空間

指数型分布族が持つ最も美しい性質の一つが **双対平坦性（dually flat）** である。

通常の多様体は一般に曲がっているが、指数型分布族の空間は：

- **e-接続に関して平坦（e-flat）**：自然パラメータ $\boldsymbol{\theta}$ を座標とすると、e-測地線は直線となり、接続の曲率は0。
- **m-接続に関して平坦（m-flat）**：期待値パラメータ $\boldsymbol{\eta} = \mathbb{E}[\mathbf{t}(x)]$ を座標とすると、m-測地線は直線となり、接続の曲率は0。

この2つの平坦性が **同時に成り立つ** 空間を **双対平坦空間（dually flat space）** と呼ぶ。

| 座標系 | 接続 | 測地線の表現 | Softmaxでの対応 |
| --- | --- | --- | --- |
| 自然パラメータ $\boldsymbol{\theta}$ | e-平坦 | $\boldsymbol{\theta}(t) = (1-t)\boldsymbol{\theta}_0 + t\boldsymbol{\theta}_1$ | 商空間 $\mathbb{R}^K / \mathbb{R}\mathbf{1}$ 上の直線 |
| 期待値パラメータ $\boldsymbol{\eta}$ | m-平坦 | $\boldsymbol{\eta}(t) = (1-t)\boldsymbol{\eta}_0 + t\boldsymbol{\eta}_1$ | 確率単体 $\Delta^{K-1}$ 上の直線 |

これら2つのパラメータは、ルジャンドル変換で結ばれている：

$$\psi(\boldsymbol{\theta}) + \phi(\boldsymbol{\eta}) = \boldsymbol{\theta}^\top \boldsymbol{\eta}, \quad \boldsymbol{\eta} = \nabla_{\boldsymbol{\theta}} \psi(\boldsymbol{\theta}), \quad \boldsymbol{\theta} = \nabla_{\boldsymbol{\eta}} \phi(\boldsymbol{\eta})$$

ここで $\psi$ は対数分配関数（log-partition function）、 $\phi$ はその双対関数である。

### ルジャンドル変換の幾何学的意味

ルジャンドル変換は、数式上は単なる変数の交換に見えるが、幾何学的には **「曲線を点の軌跡として見るか、接線の包絡線として見るか」** という視点の転換を意味する。

凸関数 $\psi(\boldsymbol{\theta})$ のグラフを記述するには2つの方法がある：

- **点の集合として**：各点 $\boldsymbol{\theta}$ における高さ $\psi(\boldsymbol{\theta})$ を指定する。
- **接線の集合として**：各点における接線の「傾き $\boldsymbol{\eta} = \nabla\psi(\boldsymbol{\theta})$」と「切片 $-\phi(\boldsymbol{\eta})$」を指定する。

切片の符号反転を新しい関数 $\phi(\boldsymbol{\eta})$ と定義すると、元の関数 $\psi$ と $\phi$ は互いにルジャンドル変換の関係になる。つまり、**ルジャンドル変換とは、曲線を「点の軌跡」と見るか「接線の包絡線」と見るかの翻訳作業** に他ならない。元の関数が（強）凸であれば、この翻訳は可逆であり、情報は一切失われない。

> [!NOTE]
> **Softmaxにおけるルジャンドル変換の具体例：**
>
> Softmaxの文脈では、この変換は **LogSumExp関数** と **負のエントロピー** の間の双対性として現れる。
>
> **主ポテンシャル（対数分配関数）**：
> $$\psi(\boldsymbol{\theta}) = \log \sum_{i=1}^K \exp(\theta_i)$$
> この勾配をとると、期待値パラメータ（確率）が得られる：
> $$\boldsymbol{\eta} = \nabla_{\boldsymbol{\theta}} \psi(\boldsymbol{\theta}) = \text{Softmax}(\boldsymbol{\theta})$$
>
> **双対ポテンシャル（負のエントロピー）**：
> ルジャンドル変換によって得られる双対関数 $\phi(\boldsymbol{\eta})$ は、シャノンエントロピー $H(\boldsymbol{\eta})$ の符号反転となる：
> $$\phi(\boldsymbol{\eta}) = \sum_{i=1}^K \eta_i \log \eta_i = -H(\boldsymbol{\eta})$$
> この勾配をとると、自然パラメータ（ロジット）が復元される：
> $$\boldsymbol{\theta} = \nabla_{\boldsymbol{\eta}} \phi(\boldsymbol{\eta}) = (\log \eta_1, \dots, \log \eta_K)^\top$$
> *（注：厳密には商空間のため定数の不定性がある）*
>
> Softmax（LogSumExpの勾配）と負のエントロピー（その双対関数の勾配）は、まさに「同じ曲線を点から見るか接線から見るか」の関係にある。

### 物理学とのアナロジー

ルジャンドル変換は、物理学の複数の分野で本質的な役割を果たす。情報幾何学の双対構造は、これらの物理的構造と数学的に同型であり、単なるアナロジーを超えた共通の原理を持つ。

**解析力学**：ラグランジアン $L$（一般化速度 $\dot{q}$ の関数）からハミルトニアン $H$（一般化運動量 $p$ の関数）への変換は、ルジャンドル変換そのものである。

| 解析力学 | 情報幾何（Softmax） |
| --- | --- |
| 一般化速度 $\dot{q}$ | ロジット $\boldsymbol{\theta}$ |
| 一般化運動量 $p = \partial L / \partial \dot{q}$ | 確率 $\boldsymbol{\eta} = \nabla \psi(\boldsymbol{\theta})$ |
| ラグランジアン $L$ | 対数分配関数 $\psi$ |
| ハミルトニアン $H$ | 負のエントロピー $\phi$ |

**熱力学**：自然パラメータは「強度量」（温度 $T$ 、化学ポテンシャル $\mu$ ）に、期待値パラメータは「示量量」（エントロピー $S$ 、粒子数 $N$ ）に対応する。エネルギーと自由エネルギーの関係もルジャンドル変換で記述される。

この視点に立てば、Softmax関数は **「ロジットという速度を確率という運動量に変換する操作」** であり、情報幾何学という相空間における正準変換の一種と見なすことができる。

**Softmaxとの関係**：
カテゴリカル分布において：

- 自然パラメータ = ロジット $\mathbf{z}$ （商空間 $\mathbb{R}^K / \mathbb{R}\mathbf{1}$ として）
- 期待値パラメータ = 確率 $\mathbf{p}$ （より正確には、指示関数の期待値）
- Softmax = **ルジャンドル変換の勾配写像** $\mathbf{p} = \nabla_{\mathbf{z}} \psi(\mathbf{z})$

ここで $\psi(\mathbf{z}) = \log \sum_j \exp(z_j)$ は対数分配関数（log-partition function）である。Softmaxは、この $\psi$ の勾配として、自然パラメータから期待値パラメータへの変換を与える。

逆向き（**ロジットの代表元の復元**）は $z_i = \log p_i + C$ （ $C$ は任意定数）となるが、これは $p_i > 0$ の範囲（単体の内部）でのみ定義される。境界 $p_i = 0$ では $\log p_i$ が発散するため、代表元の復元は定義されない。また、商空間のもとでは定数 $C$ はゲージ固定によって一意に決まる。例えば $\sum_i z_i = 0$ を課すと、 $C = -\frac{1}{K}\sum_i \log p_i$ となる。この構造こそが、Softmaxが商空間を経由する写像であることの現れである。

Softmaxの背後には、この双対平坦構造が隠れている。Softmaxが「自然な」変換であるのは、指数型分布族の双対構造が要請する勾配写像だからである。

> [!IMPORTANT]
> **なぜ双対平坦性が重要か**：
>
> 1. **KLダイバージェンスの構造**：双対平坦空間では、KLダイバージェンスが **Bregmanダイバージェンス** として表現され、**ピタゴラスの定理** の一般化（三平方分解）が成り立つ。これにより、e-射影（最尤推定）やm-射影（モーメント法）といった **情報射影（information projection）** が幾何学的に理解できる。
> 2. **自然勾配の座標不変性**：自然勾配は、Fisher計量に関して **座標系によらず最急降下** を実現する。指数型分布族では自然パラメータと期待値パラメータの間の変換が簡潔であり、Fisher情報行列が扱いやすい構造を持つ（**ただし制約により特異になることもあり**、例えば、カテゴリカル分布で確率 $\mathbf{p}$ を座標に取ると Fisher は $\text{diag}(\mathbf{p}) - \mathbf{p}\mathbf{p}^T$ の形を持ち、単体制約のもとで低次元化や擬似逆を使って効率的に計算できる）。
> 3. **パラメータ表現の指針**：機械学習において「どのパラメータ表現を使うか」は性能に影響する。双対平坦構造は、この選択に対する理論的な指針を与える。特に、損失関数と整合する座標系（自然パラメータか期待値パラメータか）を選ぶことで、最適化が効率化される。
