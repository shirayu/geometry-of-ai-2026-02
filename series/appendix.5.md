
# 情報幾何学における双対構造：2種類のまっすぐ

情報幾何学の最も深い洞察の一つは、確率分布の空間には **2種類の「まっすぐ」** が存在するということである。これは通常のユークリッド空間では区別されないが、確率空間の本質的な非対称性を反映している。

## e-接続とm-接続

**接続（connection）** とは、多様体上でベクトルを「平行移動」する方法を定める構造である。通常のユークリッド空間では一意だが、曲がった空間では複数の「まっすぐ」の定義がありうる。

情報幾何学では、Fisher計量と整合的な2つの接続が特に重要である：

| 接続 | 名称 | 測地線の特徴 | 自然なパラメータ空間 |
| --- | --- | --- | --- |
| **e-接続** | 指数接続<br>(exponential connection) | 指数型分布族で直線 | 自然パラメータ $\boldsymbol{\theta}$ |
| **m-接続** | 混合接続<br>(mixture connection) | 凸結合（混合分布）で直線 | 期待値パラメータ $\boldsymbol{\eta}$ |

これらは **双対アファイン接続（dual affine connections）** と呼ばれ、Fisher計量に関して互いに双対である。

**e-接続における測地線**：
指数型分布族 $p(x; \boldsymbol{\theta}) = \exp(\boldsymbol{\theta}^\top \mathbf{t}(x) - \psi(\boldsymbol{\theta}))$ において、自然パラメータ $\boldsymbol{\theta}$ を線形補間すると、それは e-接続の測地線となる：

$$p_t(x) = \exp\Big(\boldsymbol{\theta}(t)^\top \mathbf{t}(x) - \psi(\boldsymbol{\theta}(t))\Big), \quad \boldsymbol{\theta}(t) = (1-t)\boldsymbol{\theta}_0 + t\boldsymbol{\theta}_1$$

Softmaxで言えば、**商空間 $\mathbb{R}^K / \mathbb{R}\mathbf{1}$ 上での直線（あるいはゲージ固定したロジット座標での直線）が、e-接続の測地線に対応する**。前述の通り、Softmaxは $\mathbf{1}$ 方向の平行移動に不変であるため、e-測地線も実質的にこの商空間上で定義される。

**m-接続における測地線**：
一方、確率分布の凸結合（混合分布）：

$$p_t(x) = (1-t)p_0(x) + t p_1(x)$$

これは m-接続の測地線となる。**カテゴリカル分布の場合**、期待値パラメータ $\boldsymbol{\eta}$ は確率 $\mathbf{p}$ そのものに対応するため、確率単体 $\Delta^{K-1}$ をユークリッド空間の部分集合と見たときの通常の直線が、この測地線に対応する。

> [!NOTE]
> **「2種類のまっすぐ」の直感：**
>
> - **e-接続（指数）**：「掛け算の世界」での直線。確率の対数（ロジット）を線形補間すると、指数をとって戻したとき e-測地線になる。
> - **m-接続（混合）**：「足し算の世界」での直線。確率そのものを線形補間すると m-測地線になる。
>
> これら2つは、空間の「曲がり方」の異なる2つの見方を提供する。どちらが「正しい」のではなく、両方が情報幾何学の対称的な構造を構成する。

## 双対平坦空間

指数型分布族が持つ最も美しい性質の一つが **双対平坦性（dually flat）** である。

通常の多様体は一般に曲がっているが、指数型分布族の空間は：

- **e-接続に関して平坦（e-flat）**：自然パラメータ $\boldsymbol{\theta}$ を座標とすると、e-測地線は直線となり、接続の曲率は0。
- **m-接続に関して平坦（m-flat）**：期待値パラメータ $\boldsymbol{\eta} = \mathbb{E}[\mathbf{t}(x)]$ を座標とすると、m-測地線は直線となり、接続の曲率は0。

この2つの平坦性が **同時に成り立つ** 空間を **双対平坦空間（dually flat space）** と呼ぶ。

| 座標系 | 接続 | 測地線の表現 | Softmaxでの対応 |
| --- | --- | --- | --- |
| 自然パラメータ $\boldsymbol{\theta}$ | e-平坦 | $\boldsymbol{\theta}(t) = (1-t)\boldsymbol{\theta}_0 + t\boldsymbol{\theta}_1$ | 商空間 $\mathbb{R}^K / \mathbb{R}\mathbf{1}$ 上の直線 |
| 期待値パラメータ $\boldsymbol{\eta}$ | m-平坦 | $\boldsymbol{\eta}(t) = (1-t)\boldsymbol{\eta}_0 + t\boldsymbol{\eta}_1$ | 確率単体 $\Delta^{K-1}$ 上の直線 |

これら2つのパラメータは、ルジャンドル変換で結ばれている：

$$\psi(\boldsymbol{\theta}) + \phi(\boldsymbol{\eta}) = \boldsymbol{\theta}^\top \boldsymbol{\eta}, \quad \boldsymbol{\eta} = \nabla_{\boldsymbol{\theta}} \psi(\boldsymbol{\theta}), \quad \boldsymbol{\theta} = \nabla_{\boldsymbol{\eta}} \phi(\boldsymbol{\eta})$$

ここで $\psi$ は対数分配関数（log-partition function）、 $\phi$ はその双対関数である。

**Softmaxとの関係**：
カテゴリカル分布において：

- 自然パラメータ = ロジット $\mathbf{z}$ （商空間 $\mathbb{R}^K / \mathbb{R}\mathbf{1}$ として）
- 期待値パラメータ = 確率 $\mathbf{p}$ （より正確には、指示関数の期待値）
- Softmax = **ルジャンドル変換の勾配写像** $\mathbf{p} = \nabla_{\mathbf{z}} \psi(\mathbf{z})$

ここで $\psi(\mathbf{z}) = \log \sum_j \exp(z_j)$ は対数分配関数（log-partition function）である。Softmaxは、この $\psi$ の勾配として、自然パラメータから期待値パラメータへの変換を与える。

逆向き（**ロジットの代表元の復元**）は $z_i = \log p_i + C$ （ $C$ は任意定数）となるが、これは $p_i > 0$ の範囲（単体の内部）でのみ定義される。境界 $p_i = 0$ では $\log p_i$ が発散するため、代表元の復元は定義されない。また、商空間のもとでは定数 $C$ はゲージ固定によって一意に決まる。例えば $\sum_i z_i = 0$ を課すと、 $C = -\frac{1}{K}\sum_i \log p_i$ となる。この構造こそが、Softmaxが商空間を経由する写像であることの現れである。

Softmaxの背後には、この双対平坦構造が隠れている。Softmaxが「自然な」変換であるのは、指数型分布族の双対構造が要請する勾配写像だからである。

> [!NOTE]
> **物理学との類似**：双対平坦構造とルジャンドル変換は、統計力学や熱力学にも現れる。自然パラメータは「強度量」（温度、化学ポテンシャル）に、期待値パラメータは「示量量」（エントロピー、粒子数）に対応し、エネルギーと自由エネルギーの関係もルジャンドル変換で記述される。

> [!IMPORTANT]
> **なぜ双対平坦性が重要か**：
>
> 1. **KLダイバージェンスの構造**：双対平坦空間では、KLダイバージェンスが **Bregmanダイバージェンス** として表現され、**ピタゴラスの定理** の一般化（三平方分解）が成り立つ。これにより、e-射影（最尤推定）やm-射影（モーメント法）といった **情報射影（information projection）** が幾何学的に理解できる。
> 2. **自然勾配の座標不変性**：自然勾配は、Fisher計量に関して **座標系によらず最急降下** を実現する。指数型分布族では自然パラメータと期待値パラメータの間の変換が簡潔であり、Fisher情報行列が扱いやすい構造を持つ（**ただし制約により特異になることもあり**、例えば、カテゴリカル分布で確率 $\mathbf{p}$ を座標に取ると Fisher は $\text{diag}(\mathbf{p}) - \mathbf{p}\mathbf{p}^T$ の形を持ち、単体制約のもとで低次元化や擬似逆を使って効率的に計算できる）。
> 3. **パラメータ表現の指針**：機械学習において「どのパラメータ表現を使うか」は性能に影響する。双対平坦構造は、この選択に対する理論的な指針を与える。特に、損失関数と整合する座標系（自然パラメータか期待値パラメータか）を選ぶことで、最適化が効率化される。
