# 第13回：高次元の深淵

## 問題 13-1 ★ 赤道集中現象

高次元球面における「赤道集中現象」を数値的に確認せよ。n次元単位球面上の一様分布からサンプルを取り、第1座標 x₁ の分布を n=3, 100, 1000 で比較せよ。

**ヒント:** 高次元一様球面サンプリング：正規分布からサンプルしてL2正規化。

**解答:**

```13_equator_concentration.py
import numpy as np
import matplotlib.pyplot as plt

fig, axes = plt.subplots(1, 3, figsize=(12, 4))

for ax, n in zip(axes, [3, 100, 1000]):
    # n次元単位球面上の一様サンプル
    samples = np.random.randn(10000, n)
    samples = samples / np.linalg.norm(samples, axis=1, keepdims=True)

    x1 = samples[:, 0]  # 第1座標
    ax.hist(x1, bins=50, density=True)
    ax.set_title(f"n = {n}, std(x₁) = {np.std(x1):.4f}")
    ax.set_xlabel("x₁")

plt.tight_layout()
plt.show()
```

**観察:**

- n=3：x₁ は広い範囲（-1から1）に分布
- n=100：x₁ は0付近に集中（std ≈ 0.1）
- n=1000：x₁ はほぼ0（std ≈ 0.03）

**解釈:** 高次元では、ほぼすべての点が「赤道」（x₁=0の超平面との交点付近）に集中する。「北極」や「南極」にはほとんど誰もいない。

## 問題 13-2 ★★ Expert Collapseの幾何学

MoEで「Expert Collapse」（一部のExpertに負荷が集中）が起きる原因を、幾何学的観点から考察せよ。

**ヒント:** ルーターの重みと入力の関係、正のフィードバックループを考えよ。

**解答:**
**幾何学的原因:**

1. **初期化の偏り:**
   - ルーター重みの初期化により、ある領域の入力が特定のExpertに偏って送られる
   - その領域がたまたま頻出だと、そのExpertが多く使われる

2. **正のフィードバック:**
   - 多く使われるExpertは、その入力分布に適応して学習が進む
   - 学習が進むと、さらにそのExpertが「得意」になり、より多くの入力を引き付ける
   - 部分空間がそのExpertの方向に「偏る」

3. **他のExpertの萎縮:**
   - 使われないExpertは更新されず、初期状態のまま
   - 相対的にますます「役に立たない」存在に

**幾何学的解釈:** 入力空間の分割が不均等になり、一部のExpertが広大な領域を担当、他は狭い（またはほぼ空の）領域のみを担当する状態。

**対策（Load Balancing Loss）:** 各Expertへの割り当てを均等化する正則化を加え、部分空間の均等分割を促す。
